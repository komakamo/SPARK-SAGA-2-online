<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>SPARK SAGA — Coming Soon</title>
  <link rel="manifest" href="public/manifest.json">
  <meta name="theme-color" content="#0f172a">
  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans JP',sans-serif;
         background:#0f172a;color:#e5e7eb;display:grid;place-items:center;min-height:100dvh}
    .card{max-width:720px;padding:24px 28px;background:#111827;border:1px solid #1f2937;border-radius:16px}
    h1{font-size:28px;margin:0 0 8px}
    p{line-height:1.7}
    code{background:#1f2937;padding:2px 6px;border-radius:6px}
    .small{opacity:.8;font-size:12px;margin-top:12px}
    button{appearance:none;background:#2563eb;border:none;color:#fff;padding:10px 14px;border-radius:10px;cursor:pointer}
  </style>
</head>
<body>
  <div class="card">
    <h1>SPARK SAGA（仮）</h1>
    <p>ここはプレースホルダーです。ゲーム本体は <strong>JulesのPR</strong> で実装され、GitHub Pages に自動デプロイされます。</p>
    <p>オフラインでもこの画面は起動します（PWA）。スマホでは「ホーム画面に追加」して遊べます。</p>
    <button id="installBtn" hidden>インストール</button>
    <div class="small">v0.0.1 — PWAプレースホルダ。仕様は <code>docs/spec.md</code> を参照。</div>
  </div>
  <script>
    // --- PWA Service Worker ---
    if('serviceWorker' in navigator){ navigator.serviceWorker.register('./sw.js'); }

    // --- PWA Install Prompt ---
    let deferredPrompt; const btn=document.getElementById('installBtn');
    window.addEventListener('beforeinstallprompt', (e)=>{ e.preventDefault(); deferredPrompt=e; btn.hidden=false; });
    btn?.addEventListener('click', async()=>{
      if(!deferredPrompt) return;
      deferredPrompt.prompt();
      const {outcome}=await deferredPrompt.userChoice;
      deferredPrompt=null;
      btn.hidden=true;
    });

    // --- Performance Telemetry (Pseudo) ---
    window.addEventListener('load', () => {
      setTimeout(() => {
        const perf = window.performance?.getEntriesByType?.('navigation')?.[0];
        if (!perf) return;
        const isReload = perf.type === 'reload';
        const loadTime = Math.round(perf.duration);
        console.log(
          `%c[SPARK SAGA] Telemetry %c(pseudo)`,
          'font-weight:bold; color:#38bdf8;',
          'font-weight:normal; color:inherit;'
        );
        console.log(`- Page Load Time: %c${loadTime}ms`, 'font-weight:bold;');
        console.log(`- Visit Type: %c${isReload ? 'Reload' : 'Initial' }`, 'font-weight:bold;');
        console.log(`- Spec: Initial ≤6000ms, Re-visit ≤3000ms`);
        const goal = isReload ? 3000 : 6000;
        if (loadTime <= goal) {
          console.log(`%c- Result: PASSED`, 'color:#22c55e;');
        } else {
          console.log(`%c- Result: FAILED`, 'color:#ef4444;');
        }
      }, 0);
    });
  </script>
</body>
</html>
