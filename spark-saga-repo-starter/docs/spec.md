# 仕様書（完全版 / Jules実装前提）
プロジェクト名：**SPARK SAGA（仮）** — “SaGa-like”自由度JRPGを**ブラウザ1クリック起動**で公開  
前提：**予算0円**／**Julesの実行は1日100回まで**／あなたは**設計とレビューのみ**

## 0. ゴール（Doneの定義）
- GitHub Pages 公開URLで**即起動**（初回≤6s/再訪≤3s）。
- **PWA**：インストール可・オフライン起動OK。
- **MVP**：6〜10h分のプレイ範囲（§3）。
- セーブ：ローカル3スロ＋JSON I/O。
- アクセシビリティ：文字サイズ/配色/点滅抑制/操作リマップ。
- ライセンス：コードMIT、アセットはCC0/CC-BYのみ。
- 自動テスト：戦闘式/ドロップ/イベント分岐で20本以上が緑。

## 1. 非機能・配布
- Web（PC/スマホ）、GitHub Pages＋itch.ioミラー可（静的）。
- 目標60FPS/下限30FPS。WebP/Ogg/遅延読み込み。
- Service Worker でプリキャッシュ。匿名テレメトリは**オプトイン**のみ。

## 2. 柱（再解釈SaGa）
- 多主人公×非線形、戦闘中の**閃き（Spark）**、**LP管理**、**陣形**、**ER（イベントランク）**、軽い地域経済。

## 3. MVPスコープ
- 地域6（拠点1＋周辺5）／主人公3／敵20＋ボス5／系統9／スキル30〜40／陣形6／クエ24／BGM10〜12。

## 4. 世界観と主人公（例）
- レイ＝ヴァン（剣/小剣）、ミラ＝サイ（槍/弓）、ドルガン（斧/棍棒/体術）。
- 地域：星港アストラ/砂海バザール/霧の森林/鉱脈の谷/朽ちた水都/星見の古塔。

## 5. 進行
- ER=0..3。戦闘数や主要フラグで上昇し、クエ/敵/店売りが段階変化。
- 派閥（商会/鉱山組合/祠守/傭兵団）の評判-100..+100。周回で一部引継ぎ。

## 6. 戦闘（確定）
- 基礎：HP/LP/腕力/体力/器用/素早/知力/意志/運。
- 資源：WP/JP、自然回復0（装備/陣形で補正）。LPはHP0で-1し起き上がり（基本1回）。
- 行動値=素早×乱数(0.85〜1.15)+スキル速度補正（小さい方が先行）。
- 命中=基礎命中+器用/素早補正−相手回避。クリ率=運×係数+補正（≤30%）。
- 物理D=(武器攻×A)+(腕力×B)+威力 → (1-防/(防+K))×耐性×乱数。術は術抵抗参照。
- 状態：毒/出血/麻痺/スタン/睡眠/混乱/沈黙/石化/凍結/炎上（タグ・持続管理）。
- 陣形6：鶴翼/虎陣/方円/魚鱗/雁行/双星。
- 閃き：未習得系統×敵タグ×ピンチ等で確率発動（基礎2〜6%×補正）、即実行→習得。
- 敵AI：重み選択＋フェーズ（HP70/40%境）。

## 7. 成長/装備/経済
- 使用系統に応じたクラスレス成長（確率上昇）。装備は武器/盾/頭/体/アクセ×2、OP付与可。
- 軽量クラフト。需要供給指数-10..+10で価格±10%（OFF可）。

## 8. 画面/UX
- 戦闘UI：敵隊列/ログ/コマンド/パーティ表示。編成/装備はDnD。クエログ、設定、セーブI/O。

## 9. コンテンツ
- 武器系統と代表スキル、耐性タグ、敵20、ボス5、主要クエ導線（省略せず別紙で定義）。

## 10. データ駆動（JSON）
- `/data/*.json` に skill/weapon/enemy/formation/event/quest/loot/shop/faction/balance/i18n。
- IDは`snake_case`文字列。相互参照はビルド時に検証。

### skill.json（例）
{ "id":"sword_moonlight","name":"月光","category":"weapon","weapon_type":"sword",
  "cost":{"wp":3},"power":28,"speed_mod":-5,"crit_mod":0.05,"tags":["slash","single"],
  "inflict":[{"status":"bleed","chance":0.2}],
  "spark_conditions":[{"enemy_tag":"flying"},{"low_hp":true}],
  "learn_source":["spark","scroll"],"animation":"slash_moon","desc":"先行小威力" }

### enemy.json（例）
{ "id":"sand_scorpion","level":6,"tags":["carapace"],
  "stats":{"hp":120,"lp":2,"str":12,"vit":10,"dex":8,"agi":7,"int":4,"wil":6,"luk":5},
  "resist":{"slash":0.8,"pierce":1.2,"blunt":1.0,"fire":0.9,"ice":1.1,"shock":1.2},
  "skills":["tail_sting","sand_blast"],
  "ai":{"style":"aggressive","phase":[{"hp_leq":0.7,"prefer":["tail_sting"]},{"hp_leq":0.4,"prefer":["sand_blast"]}]} }

## 11. セーブ/ロード
- オートセーブ（戦闘/エリア移動後）。localStorageに3スロ＋JSON I/O。バージョンIDでマイグレーション。

## 12. QA/テスト
- 式の境界/分布/ドロップ偏差/イベント分岐。E2E：新規→最初のボス撃破。

## 13. ローカライズ
- i18nキーと `data/i18n/ja.json, en.json`。Fonts: Noto Sans JP, Inter。

## 14. アセット（0円）
- 画像/音は CC0/CC-BY のみ。`ASSETS_LICENSE.md` に記録。

## 15. 運用
- ブランチ: main（公開）/dev（開発）。SemVer。

## 16. リスク
- 範囲肥大/バランス/モバイル負荷/ライセンス事故。

## 17. スケジュール（4週）
- W1 雛形/移動/会話/戦闘最小/1ボス/セーブ → W4 仕上げ＆公開。

## 18. Jules運用（100回/日）
- 1タスク=1成果物。Issueテンプレで目的/要件/受入/制約/参照を明記。
- デイリーフロー：朝に小粒Issue 15〜25件→日中実行→夕方レビュー→`dev`マージ→`main`は1日1回。

### 初期バックログ（抜粋25）
雛形+Pages+PWA、描画基盤、データローダ、フィールド移動、会話、戦闘最小、リソースUI、式テスト、命中回避クリ、状態異常、陣形、閃き、敵AI、リザルト/ドロップ、セーブ/ロード、クエログ/派閥、ER、ショップ/需給、編成/装備、アセットローダ、i18n、アクセシビリティ、チュートリアル、オート戦、E2E。

## 19. バランス
- 雑魚3T/ボス6〜9T。勝率：雑魚85–95%/ボス40–60%。`/data/balance.json`の係数で一括調整。

## 20. 操作
- PC: 矢印/WASD, Enter/Space, Esc, Tab, Q/E。モバイル: 仮想D-Pad＋大ボタン3。

## 21. 法務
- MIT / CC0-1.0 or CC-BY-4.0。IP類似名称を避ける。

## 22. リリース前チェック
- オフライン起動/ロード時間/アクセシ/レスポンシブ/ライセンス台帳/`v0.1.0`タグ。
