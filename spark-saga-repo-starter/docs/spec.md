仕様書（完全版 / Jules実装前提）

プロジェクト名：SPARK SAGA（仮） — “SaGa-like”自由度JRPGをブラウザ1クリック起動で公開
前提：予算0円／Julesの実行は1日100回まで／あなたは設計とレビューのみ、コーディングは一切しない

0. ゴール（Doneの定義）

GitHub Pages で公開されたURLを開くと即起動（ローディング≤6秒/初回、≤3秒/2回目以降、4G回線想定）。

PWA対応：インストール可能・オフラインでも前回のバージョンが起動。

MVPスコープ（§3参照）を満たすプレイアブル：6〜10時間の読了可能コンテンツ。

セーブ：ローカル3スロット＋JSONでエクスポート/インポート（ドラッグ&ドロップ対応）。

アクセシビリティ：文字サイズ可変/色覚配慮モード/フラッシュ回避/操作リマップ。

法務：コードはMIT/Apache-2.0等のOSSライセンス、アセットはCC0/CC-BYのみ使用。クレジット表記あり。

自動テスト：戦闘式・ドロップ・イベント条件に最低20本のユニットテストが緑。

1. 非機能要件 / 配布

プラットフォーム：Web（PC/スマホ）

配布：GitHub Pages（メイン）。ミラー：itch.io（静的ビルドをそのままアップ）※費用0円

ターゲット端末：Chrome/Edge/Firefox/iOS Safari（最新＋1メジャー）。

パフォーマンス：60FPS目標/30FPS下限。画像はWebP、音はOgg、lazy load。

オフライン：Service Workerでcore assetsをプリキャッシュ。

トラッキング：匿名・オプトインのみ（起動回数、ボス敗北回数、クラッシュ）。

2. ゲームの柱（SaGa要素の再解釈）

多主人公×非線形進行：序盤の選択で中盤以降の主要イベントが分岐。

閃き（Spark）：戦闘中に条件一致で新スキルをひらめき、その場で即発動＆習得。

陣形×武器系統×LP：前後列補正と武器適性、**LP（ライフポイント）**で緊張感。

イベントランク（ER）：周回・戦闘数で世界のクエ/敵/店売りが段階変化。

軽い経済のうねり（任意ON）：地域需給で価格・素材レア度が微変動（負荷を抑制）。

3. MVPスコープ

地域：6（拠点都市1＋周辺5）

主人公：3（各ルート固有導入＋専用クエ3）

敵：通常20種／ボス5

武器系統：9（剣・大剣・小剣・槍・斧・棍棒・弓・体術・杖/術）

スキル：30〜40（各系統3〜5）

陣形：6

クエスト：汎用15＋主人公専用9（=合計24）

BGM：10〜12曲（CC0/CC-BY）

4. 世界観・主人公
4.1 主人公（例）

レイ＝ヴァン（剣/小剣）：失われた王家の指輪を追う流浪の護衛。俊敏・器用、LP低め。

ミラ＝サイ（槍/弓）：砂海の遊牧学者。古遺跡の星図を解読し災異の兆しを知る。知力高。

ドルガン（斧/棍棒/体術）：廃坑の労務隊頭。鉱山利権と魔獣出現の黒幕を追う。体力・腕力高。

4.2 地域（6）

星港アストラ（拠点）：ギルド/鍛冶/図書館/クエ板。

砂海バザール：交易と闘技場。砂獣多め。

霧の森林：毒・混乱の敵。精霊の祠。

鉱脈の谷：打撃に弱い甲殻種。落盤ギミック。

朽ちた水都：水棲・雷弱点、仕掛け水門。

星見の古塔：終盤ダンジョン。ボスが配置変化。

5. 進行・イベント

ER：0/1/2/3の4段階。戦闘勝利数・主要フラグで上昇。

派閥/評判：星港商会、鉱山組合、祠守、傭兵団（-100〜+100）。

クエカテゴリ：メイン導線/地域固有/派閥/依頼板（繰り返し微報酬）。

分岐ルール：ER≥2で一部の低難度クエが消滅、代わりに上位版が出現。

周回：1周目エンド後、敵図鑑/スキル図鑑/派閥評判の一部を引継ぎ。

6. 戦闘システム（確定仕様）
6.1 パラメータ

基礎：HP / LP / 腕力 / 体力 / 器用 / 素早 / 知力 / 意志 / 運

派生：攻撃力（武器×腕力/器用補正）／術力（杖×知力）／防御力（体力）／回避（素早）／抵抗（意志）

6.2 リソース

WP（武技ポイント）、JP（術技ポイント）；ターン毎の自然回復0、装備や陣形で回復あり。

LP：0→戦闘不能。HP0でLP-1して立ち上がる（最大1回/戦闘、装備で増加可）。

6.3 行動順

行動値＝素早×乱数(0.85〜1.15)＋スキル速度補正。低いほど先行。

6.4 命中・回避・クリティカル

命中率＝基礎命中（スキル）＋命中補正（器用/素早）− 相手回避

クリ率＝運×係数＋スキル補正（上限30%）

6.5 ダメージ式（物理）
基本D = (武器攻×A) + (腕力×B) + スキル威力
実D  = 基本D × (1 - 敵防御/（敵防御+K）) × 耐性補正 × 乱数(0.9〜1.1)


係数A,B,Kはデータファイルで調整可能（例：A=1.0, B=0.7, K=50）。

術は（杖補正×知力×術式係数）で同様に算出、物防ではなく術抵抗を参照。

6.6 状態異常（例）

毒/出血/麻痺/スタン/睡眠/混乱/沈黙/石化/凍結/炎上（各：命中式→耐性で減衰、持続と解除条件はタグ管理）

6.7 陣形（6）

鶴翼：後列被弾↓、弓/術命中↑

虎陣：前列攻↑、被弾↑

方円：全員被弾↓、行動値+5%

魚鱗：先頭挑発↑、カウンター率↑

雁行：行動値-10%（先行）、クリ率↑

双星：2人連携発生率↑、後列攻↓

6.8 閃き（Spark）

トリガ：

「未習得系統スキルを所持武器で攻撃」

「特定敵タグ（甲殻/飛行/霊）に対し有効スキル候補」

「HP25%以下/仲間戦闘不能/特定陣形」

確率：基礎（2〜6%）×（系統適性/敵タグ一致/主人公補正）

演出：専用カットイン→新スキル即時発動→習得。

6.9 敵AI

重み選択（HP/耐性/プレイヤー状態/派閥フラグ）＋「型」（攻撃的/支援/妨害/召喚）。

フェーズ：ボスはHP70/40%で行動パターン変化。

7. 成長・装備・経済

クラスレス成長：戦闘後に「使用した系統」に応じ、基礎が微上昇（確率0〜15%）。

装備：武器・盾・頭・体・アクセ×2。OP付与（+火耐性、+WP回復等）。

クラフト（軽量）：素材×設計書でOP抽選。

経済：需要供給指数（-10〜+10）で価格±10%まで。OFF可。

8. 画面/UX

タイトル：New/Continue/Import/Settings/Credits

フィールド：8方向移動/オブジェクト対話/宝箱/採取点。

戦闘UI：

上：敵隊列と状態

中：ログ

下：コマンド（攻撃/スキル/術/防御/アイテム/逃走）

右：パーティ一覧（HP/LP/WP/JP）

編成/装備：ドラッグ&ドロップ、陣形選択、推奨装備ボタン。

クエログ：メイン/派閥/地域でフィルタ、進捗タグ表示。

設定：文字サイズ・配色（ライト/ダーク/色覚D/N/P）・操作（KB/Pad/タッチ）・演出簡略化。

セーブ/ロード：スロット3＋JSON入出力、衝突時のマージなし（上書き警告）。

9. コンテンツ定義（MVP）
9.1 武器系統と代表スキル（一部例）

剣：斬撃（単体）／月光（先行小威力）／燕返し（クリ率↑）

大剣：轟断（防御無視小）／地割（列）／重破（スタン付与）

小剣：刺突（出血）／影走り（回避↑後攻撃）／連突（多段）

槍：霞突（速度↑）／貫穿（貫通）／竜牙（飛行特効）

斧：薪割（命中↓高威力）／旋風斬（周囲）／裂甲（甲殻特効）

棍棒：粉砕（打撃↑）／脳震（スタン）／守護印（被ダメ↓）

弓：速射（2回）／狙撃（先行高命中）／束縛矢（行動値+）

体術：連撃（多段）／受け流し（カウンター）／気合（WP回復）

杖/術：火弾/氷槍/雷鎖/風壁/石肌/沈黙の霧（バフ/デバフ系含む）

9.2 状態異常 耐性タグ（例）

甲殻/獣/植物/飛行/霊/水棲/機械/人型

9.3 敵（例：20）

砂獣、砂サソリ、砂盗、狼霊、樹鬼、霧蛇、甲殻兵、坑夫傀儡、水都衛兵、泥鰻、機巧蜘蛛、浮遊眼、亡者騎士、祠守の影、雷クラゲ、塔の番犬、星幽体、石像魔、装甲巨人、災異の苗床

9.4 ボス（5）

闘技場覇者（人型物理）／砂海の巨蠍（甲殻）／堕ちた聖騎（霊）／水門の主（水棲）／星喰みの核（終章）

9.5 陣形（§6.7の6種）
9.6 主要クエ（例）

導入：星港での失物→砂海で手掛かり→鉱脈の谷で黒幕の影

ER2以降：水都暴走の鎮圧／古塔の接近封鎖／派閥終盤選択

10. データ駆動設計（JSON仕様）

※コードではなくスキーマ。Julesはこれに沿って実装。

10.1 ディレクトリ
/public   # 画像/音/フォント（CC0/CC-BYのみ）  
/src      # 実装（Jules担当）  
/data     # すべてJSON（下記スキーマ）  
/tests    # ユニットテスト（Jules担当）  

10.2 共通：IDと参照

文字列ID（snake_case）。相互参照は文字列で、存在検証をビルド時チェック。

10.3 スキーマ（抜粋）

skill.json（配列）

{
  "id": "sword_moonlight",
  "name": "月光",
  "category": "weapon|spell",
  "weapon_type": "sword",
  "cost": {"wp": 3, "jp": 0},
  "power": 28,
  "speed_mod": -5,
  "crit_mod": 0.05,
  "tags": ["slash", "single"],
  "inflict": [{"status": "bleed", "chance": 0.2}],
  "spark_conditions": [{"enemy_tag": "flying"}, {"low_hp": true}],
  "learn_source": ["spark","scroll"],
  "animation": "slash_moon",
  "desc": "素早く斬りつける先行技。"
}


weapon.json

{
  "id": "iron_sword",
  "type": "sword",
  "atk": 12,
  "op": ["crit+2","wp_regen+1"],
  "desc": "扱いやすい剣。"
}


enemy.json

{
  "id": "sand_scorpion",
  "name": "砂蠍",
  "level": 6,
  "tags": ["carapace"],
  "stats": {"hp": 120, "lp": 2, "str": 12, "vit": 10, "dex": 8, "agi": 7, "int": 4, "wil": 6, "luk": 5},
  "resist": {"slash": 0.8, "pierce": 1.2, "blunt": 1.0, "fire": 0.9, "ice": 1.1, "shock": 1.2},
  "skills": ["tail_sting","sand_blast"],
  "ai": {"style": "aggressive", "phase":[{"hp_leq":0.7,"prefer":["tail_sting"]},{"hp_leq":0.4,"prefer":["sand_blast"]}]},
  "drops": [{"item":"scorpion_shell","rate":0.3}]
}


formation.json

{"id":"crane_wing","name":"鶴翼","row_mod":{"front":{"dmg_out":1.0,"hit":0.0},"back":{"dmg_in":0.85,"hit":0.05}},"team_mod":{"agi":0.0,"crit":0.0}}


event.json（条件分岐型）

{
  "id":"guild_lost_ring",
  "when":{"region":"astro_port","er_gte":0,"flags_not":["ring_found"]},
  "nodes":[
    {"type":"dialog","text":"護衛を探している、とギルドの受付が言う。"},
    {"type":"choice","options":[
      {"label":"依頼を受ける","set_flags":["lost_ring_accepted"],"goto":"accept"},
      {"label":"断る","goto":"end"}
    ]},
    {"id":"accept","type":"quest_start","quest_id":"lost_ring"}
  ]
}


loot_table.json / shop.json / quest.json / faction.json：同様にタグ＆条件式で管理。

11. セーブ/ロード仕様

自動保存：戦闘終了後/エリア移動後にオートセーブ。

形式：save_slot_[0..2].jsonをlocalStorageへ。

互換：バージョンIDを付与し、マイグレーションテーブルで旧→新へ。

手動：JSONドラッグ&ドロップのインポート/エクスポート。

12. QA/テスト

ユニット：

ダメージ式の境界（防御0/高防御/耐性1.5倍など）

命中/回避/クリ率の分布（10000回試行）

ドロップ率の統計偏差（±1%以内）

イベント条件分岐（旗立て/未立て）

E2E（軽量）：Cypress等で「新規開始→最初のボス撃破」までを自動実行。

パフォーマンス：画像最適化・バッチ描画・粒子上限。

13. ローカライズ

i18nキー：ui.menu.new_game 等。

文言ファイル：/data/i18n/ja.json, en.json。

フォント：Google Fonts（Noto Sans JP、Inter）※無料。

14. アセット方針（0円）

画像：自作簡易ドット＋CC0スプライト（OpenGameArt等のCC0/CC-BY限定）。

音：CC0/BYのBGM/SE、または自動生成ツール（BeepBox等）で自作。

管理：/CREDITS.mdにライセンス、作者、URL、改変有無を記録。

禁止：商用不可/NC、SA強制のもの、出典不明。

15. 運用・公開

ブランチ：main（公開）／dev（開発）。PRはdevへ。

CI：push→ビルド→テスト→devプレビュー→mainマージでPages公開。

バージョン：v0.1.0（MVP）→v1.0.0（正式）。SemVer準拠。

16. リスクと回避

コンテンツ膨張 → MVP表を固定、ERは4段階から3段階に即時縮退可能。

バランス難 → オート戦闘シミュで分布把握、敵HP/攻撃の倍率係数を一括調整。

モバイル負荷 → 解像度スケール、エフェクト簡略化スイッチ。

ライセンス事故 → 取り込み時に拡張子とLICENCEファイルの存在チェックをCIに追加。

17. スケジュール（最短4週目安）

W1：雛形・移動・会話・戦闘最小・1ボス・セーブ

W2：データ拡充（敵12/スキル20/陣形4/クエ10/主人公2）＋UI整備

W3：MVP完成（敵20/スキル35/陣形6/主人公3/ER実装）＋i18n下地

W4：BGM/SE/最適化/アクセシビリティ/チュートリアル/公開

18. Jules運用（1日100回の枠で回す）
18.1 原則

1タスク＝1成果物（PR単位を小さく）。

Issueテンプレ（Jules宛）：

目的：何ができるようになるか（ユーザ視点）。

要件：入出力・UI変更点・データの場所。

受入条件：チェックリスト（UI/操作/テスト/パフォーマンス）。

制約：ライセンス/依存/サイズ上限。

参考：該当JSONキーや既存ID。

18.2 1日の回し方（例）

朝：要件が独立な小粒Issueを15〜25件作成。

昼：Jules実行（~60回）→PR/失敗の再実行。

夕：レビュー→コメント→追加実行（余り40回）。

夜：devにマージ→main反映は1日1回のみ。

18.3 初期バックログ（Julesにそのまま渡せる粒度）

静的雛形＋Pages＋PWA（オフライン可／manifest/Service Worker）

2D描画基盤（シーン遷移・スプライト・テキスト・入力）

データローダ（/data/*.json のスキーマ検証）

フィールド移動（タイル/コリジョン/イベントトリガー）

会話エンジン（分岐/フラグ/外部文言）

戦闘最小（ターン順・攻撃・被ダメ・ログ）

リソース管理（HP/LP/WP/JPのUIと減少/回復フロー）

ダメージ計算式（§6.5）＋テスト

命中/回避/クリティカル計算＋テスト

状態異常基盤（付与/解除/耐性）

陣形効果・隊列UI

閃き（Spark）基盤（条件判定・演出・習得）

敵AI（重み選択＋フェーズ）

戦闘結果/報酬/ドロップ

セーブ/ロード（3スロ＋JSON I/O）

クエストログ/派閥評判

ER管理（戦闘数/フラグ→ER上昇→生成テーブル切替）

ショップ/価格変動（需給トグル）

編成/装備/OP付与UI

画像/音のアセットローダ（ライセンス検査）

i18nフレーム（ja→en）

アクセシビリティ（文字サイズ/配色/リマップ）

チュートリアル/ヘルプ

オート戦闘シミュ（1000戦*分布出力）

E2Eスモーク（新規→最初のボス撃破）

以降：敵/スキル/陣形/クエのデータ投入Issueを束ねて大量投入（1ファイル=1PR）。

18.4 PRの受入条件（例）

CI緑（ビルド<90秒／テスト緑）。

Lighthouse（モバイル）Performance≥70、Accessibility≥90。

バンドルサイズ初期<2.0MB（音・画像除く）。

19. バランス調整方針

敵HP係数と与ダメ係数を/data/balance.jsonで一括。

意図：平均3ターンで雑魚が終わる、ボスは6〜9ターン。

勝率：雑魚85〜95%／ボス40〜60%。シミュで確認。

20. 文字列/操作（抜粋）

キー：方向＝矢印/WASD、決定＝Enter/Space、キャンセル＝Esc、メニュー＝Tab、ターゲット切替＝Q/E。

タッチ：仮想D-pad＋大ボタン3（メニュー・決定・戻る）。

21. 法務・ライセンス

コード：MIT（LICENSE設置）。

アセット：/ASSETS_LICENSE.mdに一覧（作者/ライセンス/URL/改変/入手日）。

IP回避：名称・用語・アイコンはすべて新規。

22. 仕上げチェックリスト（公開前）

 オフライン機能テスト（機内モードで起動）

 初回→2回目のロード時間差が仕様内

 アクセシビリティ/文字サイズ/色覚モード

 スマホ縦横/PCフルHDでUI崩れなし

 ライセンスファイル更新

 v0.1.0をmainへリリース、リリースノート記載

このまま使える：最初の3つのJules用Issue（コピペ可）

#1 雛形＋Pages＋PWA

目的：URLを開くとゲームが即起動し、オフラインでも前回版が立ち上がる

要件：index.html＋/src雛形＋manifest.json＋Service Worker（静的キャッシュ）＋GitHub Actions（ビルド→Pages）

受入：オフライン起動OK／Lighthouse PWA installable／バンドル<1.5MB（初期）

#2 データローダ＋スキーマ検証

目的：/data/*.jsonを型安全に読み、ID参照の整合をCIで検出

要件：/data/skill.json,enemy.json,formation.json…を読み込み、未定義参照でビルド失敗

受入：不整合データを入れるとCIが赤／正常データで緑

#3 戦闘最小＆ログ

目的：1体vs1体の攻撃→被ダメ→撃破まで通る

要件：§6.5のダメージ式実装、HP/LP/WP/JP消費、行動順、ログ表示

受入：テスト「攻撃100回の平均ダメージが期待区間」「LP消費ロジック成立」
